<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>PE文件分析</title>
<link rel="stylesheet" href="../styles/style.css" type="text/css" />
<link rel="stylesheet" href="../styles/table.css" type="text/css" />
<script src="../script/common.js"></script>
<script type="text/javascript">
$import("rpc.js");
$import("table_list_dynamic_appended.js");

var suffixList;
var fileList;
var fileTotal;

/** 变量初始化 */
function init()
{
	suffixList = new Array();
	fileList = new Array();
	fileTotal = 0;
}

function onSubmit()
{
	init();
	if ($("folderPath").value == "" || $("folderPath").value == "路径名类似:C:/peFiles/test")
	{
		alert("请输入要分析的文件夹路径");
		return;
	}
	$("progress").style.display = "";
	$("finish").style.display = "none";
	
	var callback = function(o)
	{
		fileList = o.fileList;
		fileTotal = fileList.length;
		peAnalyzer();
	};
	
	var operation = new Operation("PE分析.装载多文件分析目录");
	operation.folderPath = $("folderPath").value;
	/** 文件类型 */
	if ($("exe").checked)
		suffixList.push("exe");
	if ($("dll").checked)
		suffixList.push("dll");
	operation.suffix = suffixList;
	/** 是否分析子目录 */
	operation.isDepth = $("yesDir").checked;
	operation.execute(callback);
}

function peAnalyzer()
{
	$("status").style.display = "";				//分析状态条
	var operations1 = 
	[
		{icon: "../images/icon_view.gif", text: "查看结果", onclick: onOpen}
	];
	var operations2 = 
	[
		{icon: "../images/icon_not_allow.gif", text: "查看结果", onclick: onError}
	];
	var titles = 
	[
		{text:"文件路径", width:"30%"},
		{text:"大小", width:"20%"},
		{text:"状态", width:"30%"},
		{text:"操作", width:"10%"}
	];
	var columns =  
	[
		function(data) { return data.path;},
		function(data) { return data.size; },
		function(data) { return data.status; },
		function(data) { 		
			return (data.status == "分析完成" ? AppendTableList.links(operations1, data) : AppendTableList.links(operations2, data)); 
			}
	]; 

	var operation = new Operation("PE分析.分析多个文件");
	var appendTableList = new AppendTableList(operation, titles, columns, fileTotal);
	appendTableList.create($("container"));
	appendTableList.append(fileList);
}

function onOpen(data)
{
	window.open("../peResult/" + data.parentFolder + "/" + data.name + ".html", "_blank");
}

function onError(data)
{
	alert(data.path + "不是有效的PE文件！");
}

/** 设置路径输入框的提示信息 */
function addListener(element,e,fn)
{   
	if(element.addEventListener)
    {   
    	element.addEventListener(e,fn,false);   
    } 
    else 
    {   
        element.attachEvent("on" + e,fn);   
    }   
}

function onLoad()
{
	var myinput = $("folderPath");
	addListener(myinput,"click",function(){
		if (myinput.value == "路径名类似:C:/peFiles/test")
			myinput.value = "";
		});
	addListener(myinput,"blur",function(){
		if (myinput.value == "")
			myinput.value = "路径名类似:C:/peFiles/test";
		});
}
</script>

</head>
<body onLoad="onLoad()">
<div id="ur_here"><img src="../images/icon_here.gif" style="align:absmiddle" align="absmiddle"/> 当前位置：首页 03 PE多个文件分析 </div>
<div id="wrap">
<div id="containaer" >
	<div class="filter">
		<div class="filterTitle">
				<table cellpadding=0 cellspacing=0 border=0 width="100%" style="border-right:1px solid #A7B9CF;">
					<tr class='tablecell'>
						<td class='tit' width="20%">指定一个待分析的文件夹</td>
						<td class='inp'>
							<input id="folderPath" name="folderPath" type="text" class="form_input_l" value="路径名类似:C:/peFiles/test"/>
						</td>
					</tr>
					<tr class='tablecell'>
						<td class='tit'>选择待分析的文件类型</td>
						<td class='inp'>
							<input id="exe" name="exe" type="checkbox" checked class="form_input" />可执行文件（*.exe）
							<input id="dll" name="dll" type="checkbox" checked class="form_input" />动态链接库文件（*.dll）
						</td>
					</tr>
					<tr class='tablecell'>
						<td class='tit'>是否分析子目录</td>
						<td class='inp'>
							<input id="yesDir" name="dirSelect" type="radio" class="form_input" />是
							<input id="noDir" name="dirSelect" type="radio" checked class="form_input" />否
						</td>
					</tr>
				</table>
		</div>
		<div class="filterInput" style="padding:28px 0px 0px 25px;">
				<input type="button" class="pe_result" onClick="onSubmit()"/>
				<span id="progress" style="display:none">文件分析中...&nbsp;<img src="../images/loading.gif"></span>
		</div>
		<div class="clear"></div>
	</div>
	<div class="title" id="status" style="display:none">
			正在分析文件:<span id="statusBar"></span>&nbsp;<img src="../images/loading.gif">请等待...
	</div>
	<div class="title" id="finish" style="display:none">
			恭喜你！目录中文件全部分析完成！
	</div>
	
	<div id="container"></div>
</div>
</div>
</body>
</html>